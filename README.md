# beacon-appengine-cordova-demo
This repository contains code that can be used to build a suite of demo apps which persist and interact with beacon data. AltBeacon and iBeacon are supported by default, adding support for Eddystone-UID and other beacon formats would be a fairly simple exercise.

The demo suite is composed of three apps:

1) admin-app - a Cordova app that allows a user to capture data representing a fleet of beacons and save it to persistent storage. Storage in this case is handled by Google app engine, with a Cloud Endpoint providing the API.

2) bbepoc - code that will be used to generate a Google Cloud Endpoint which will be used by the mobile apps to add, edit and retrieve beacon data. Note you'll need to create a new Google App Engine project and then copy this code in. Technically you only actually need the Beacon.java class, as the BeaconEndpoint.java class will be auto generated by the Google app engine plugin (at least this is how it works in Eclipse). Last time I checked however the endpoint class was generated with a bug that prevented the update of existing records, the fix for which is included in my version of the endpoint class.

3) beacon-app - a Cordova app that loads any beacons added via the admin app. On encountering a beacon the app will display whatever message the user entered against the beacon in the admin app; this could obviously be extended to handle other types of interaction, such as showing an image or playing a video.

*** Getting started.

If you're comfortable working with Cordova and with Google app engine then you probably already have your own workflow and can comfortably skip this part. If not, then walking throught the following instructions should get you up and running.

1) You'll need to install Eclipse, along with the Google plugin. The plugin officially supports versions up to Luna ( download the Java EE version here: https://eclipse.org/downloads/packages/release/Luna/SR2). Installation is mainly point and click, but full instructions on installing Eclipse can be found here: https://wiki.eclipse.org/Eclipse/Installation#Eclipse_4.4_.28Luna.29  
Instructions on getting the plugin are here https://developers.google.com/eclipse/docs/download

2) Next, you'll create a new app engine application - instructions are on the Google developer's site, here: https://developers.google.com/eclipse/docs/appengine.

3) Copy the 2 java classes from bbepoc into your Eclipse project's /src directory, right click on the project in eclipse and select "Google" then "Deploy to App Engine" from the pop up menu.

4) You'll need to run the Cordova apps on a mobile device. You have options here, but I find EvoThings the quickest and most convenient way of doing this. Install EvoThings by following the instructions here: http://evothings.com/download/

5) Once EvoThings is installed on your PC or Mac, you've installed the client on your mobile device and you've connected the client app to EvoThings Workbench, you're ready to try out the Cordova apps. Download the source of admin-app and beacon-app to your development machine and navigate to the index.html file of the app you'd like to try first - I recommend starting with the admin app, as the beacon app won't do much without beacon data. Drag the index.html file into the EvoThings Workbench window to register the app with EvoThings and then click "Run" to launch the app. You should see the app loading and then running on your device (ensure Bluetooth is enabled if you're running the beacon app, or it won't detect any beacons).

Feel free to raise an issue on this repository if these instructions don't work for you and I'll look at elaborating them if required, but please see the further instructions and known issues below first.

*** You'll need to make changes in a few files before you can get up and running:

1) On lines 201 to 207 of /admin-app/www/index.html you'll find the following code block, which connects the app to the google app engine back-end:
	<script src="https://apis.google.com/js/client.js?onload=init">
    { "client": {},
      "googleapis.config": {
        root: "https://*** YOUR APP ID ***/_ah/api"
      }
    }
	</script>
You'll need to replace *** YOUR APP ID *** with the endpoint address that appengine provided when you deployed your back-end application (e.g. 'https://1-dot-my-supercool-service.appspot.com/_ah/api').

2) In the call to gapi.client.load on line 113 of /beacon-app/www/js/index.js, you'll need to replace *** YOUR APP ID *** in the following string 'https://*** YOUR APP ID ***.appspot.com/_ah/api' with the endpoint address that appengine provided when you deployed your back-end application (e.g. 'https://1-dot-my-supercool-service.appspot.com/_ah/api').

*** Known Issues:

Please note that this is a proof of concept demo that has been developed for instructional purposes only. There are some rough edges which mean that the software is not suitable for use in a production environment in its present form. No warranty is implied or should be inferred.

* You may find there is some lag in the UI while the app loads data from the back-end and renders it. A "loading" indicator would definitely be a good thing where this occurs, but I haven't implemented such functionality here.
* There's no validation on input fields, so inserting an incorrect value can cause problems - the admin app will allow you to save a beacon without supplying a UUID, major and minor, but the interactive beacon app will not scan for beacons if it loads such a beacon from the back-end.
* The Google cloud endpoint generated by the Google plugin for Eclipse is not secured by default. OAuth security should be enabled before using a cloud endpoint in a production environment.
